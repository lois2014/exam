<?php
namespace app\admin\controller;

use app\admin\service\ProjectCategoryService;
use app\admin\service\ProjectService;


class Project extends Base
{
    public function _initialize()
    {
        parent::_initialize(); // TODO: Change the autogenerated stub
    }

    public function getProjects()
    {
        $proSer = new ProjectService();
        $res = $proSer->getPaginateList(10);
        return $this->fetch('index',$res);
    }

    public function editProject()
    {
        $data = $this->request->post();
        $proSer = new ProjectService();
        if(empty($data)){
            $id = $this->request->get('id');
            if(empty($id)) return $this->error('出错了！！',ADMIN_URL_PATH);
            $project = $proSer->getProject($id);
            $cateSer = new ProjectCategoryService();
            $cateList = $cateSer->getList();
            $this->assign('project',$project);
            $this->assign('category',$cateList);
            return $this->fetch('detail');
        }
//        var_dump($data);die;
        $res = $proSer->updateProject($data);
        if(!$res){
            return $this->error('更新失败',ADMIN_URL_PATH.'projectList');
        }
        return $this->success('更新成功',ADMIN_URL_PATH.'projectList');
    }
    public function delProject()
    {
        $id = $this->request->get('id');

        if(!empty($id)){
            $proSer = new ProjectService();
            $data=[
                'id'=>$id,
                'status'=>0
            ];
            $res = $proSer->updateProject($data);
            if(!$res){
                return $this->error('删除失败',ADMIN_URL_PATH.'projectList');
            }
            return $this->success('删除成功',ADMIN_URL_PATH.'projectList');
        }
        return $this->error('出错了！！',ADMIN_URL_PATH);
    }

    public function addProject()
    {
        $data = $this->request->post();
        $proSer = new ProjectService();
        if(empty($data)){
            $cateSer = new ProjectCategoryService();
            $cateList = $cateSer->getList();
            $this->assign('category',$cateList);
            return $this->fetch('add');
        }
//        var_dump($data);die;
        $id = $proSer->addProject($data);
        if(empty($id)){
            return $this->error('新增失败',ADMIN_URL_PATH.'projectAdd');
        }
        return $this->success('新增成功',ADMIN_URL_PATH.'projectEdit?id='.$id);
    }
}
